---
alwaysApply: true
---

# High-Signal Commenting Standards

## Core Principles

1. **Do NOT add line-by-line comments**
2. **Comments explain WHY, not WHAT**
3. **Prefer clarity through naming over comments**
4. **Remove redundant, obvious, or noisy comments**
5. **TypeScript types should be self-documenting**

## 1. Component Documentation

### Required for Every Exported Component

**Location:** After imports, before the component definition

**Format:**
```typescript
import React from "react";
import { BasePanel } from "@/components/base-panel";

/**
 * ExampleFeature
 * ----------------
 * Responsible for rendering the example feature layout
 * and coordinating subcomponents and interactions.
 */
export const ExampleFeature: React.FC = () => {
  // component code
};
```

### Required Information
- **Name:** Component name (matches file name)
- **Short responsibility description:** What the component is responsible for

### Examples

**✅ CORRECT:**
```typescript
import React from "react";
import { UploadButton } from "./upload-button";

/**
 * UploadFeature
 * ----------------
 * Manages image upload workflow including drag-and-drop,
 * file validation, and color extraction from uploaded images.
 */
export const UploadFeature: React.FC = () => {
  // ...
};
```

**❌ WRONG - Missing documentation:**
```typescript
import React from "react";

export const UploadFeature: React.FC = () => {
  // ...
};
```

**❌ WRONG - Line-by-line comments:**
```typescript
/**
 * UploadFeature
 * ----------------
 * Manages image upload workflow.
 */
export const UploadFeature: React.FC = () => {
  // Initialize file input ref
  const fileInputRef = useRef<HTMLInputElement>(null);
  
  // Get dispatch from Redux
  const dispatch = useAppDispatch();
  
  // Get preview URL from state
  const previewUrl = useAppSelector((state) => state.image.previewUrl);
};
```

## 2. Function & Hook Documentation

### Required for Every Exported Function or Hook

**Location:** Immediately before the function/hook definition

**Format:**
```typescript
/**
 * useExampleLogic
 * ----------------
 * Manages state and side effects for the example feature,
 * including async data fetching and derived UI state.
 * 
 * Side effects:
 * - Dispatches Redux actions on color changes
 * - Syncs input value with display value via useEffect
 */
export const useExampleLogic = () => {
  // hook implementation
};
```

### Required Information
- **Name:** Function/hook name
- **What it is responsible for:** Core responsibility
- **Important side effects (if any):** List any side effects

### Examples

**✅ CORRECT:**
```typescript
/**
 * useColorTools
 * ----------------
 * Calculates color values (RGB, HEX, HSL) from HSL inputs
 * and manages color mode state. Provides derived color values
 * for display and export.
 * 
 * Side effects:
 * - Dispatches setInputValue when displayValue changes
 */
export const useColorTools = () => {
  // implementation
};
```

**✅ CORRECT - Utility Function:**
```typescript
/**
 * extractColorsFromImage
 * ----------------
 * Analyzes image pixel data to extract dominant colors.
 * Returns up to maxColors colors ordered by frequency.
 * 
 * Side effects:
 * - Creates temporary canvas element
 * - Loads image via Image API
 */
export async function extractColorsFromImage(
  imageUrl: string,
  maxColors: number = 8,
): Promise<string[]> {
  // implementation
}
```

**❌ WRONG - Missing documentation:**
```typescript
export const useColorTools = () => {
  // implementation
};
```

**❌ WRONG - Explaining WHAT instead of WHY:**
```typescript
/**
 * useColorTools
 * ----------------
 * This function calculates RGB values from HSL values.
 * It uses useMemo to memoize the calculation.
 * It returns an object with baseRgb, hex, and displayValue.
 */
export const useColorTools = () => {
  // implementation
};
```

## 3. Inline Comments

### When Inline Comments Are Allowed

**Only for:**
- Non-obvious logic
- Performance-related decisions
- Architectural tradeoffs
- Complex algorithms

**Must explain WHY, not WHAT**

### Examples

**✅ CORRECT - Explains WHY:**
```typescript
// We debounce this interaction to avoid layout thrashing
// caused by rapid motion updates.
const debouncedUpdate = debounce(handleUpdate, 100);

// Quantize color values to reduce similar colors in the map
// This prevents the color extraction from returning near-duplicates
const quantize = (value: number) => Math.round(value / 10) * 10;

// Normalize hue to 0-360 range to handle negative values
// from color space conversions
h = ((h % 360) + 360) % 360;
```

**✅ CORRECT - Performance decision:**
```typescript
// Scale down image for performance (max 200px on longest side)
// Full resolution analysis is unnecessary and causes lag
const maxDimension = 200;
```

**✅ CORRECT - Architectural tradeoff:**
```typescript
// Use toBlob instead of toDataURL for better memory management
// with large images, even though it requires async handling
if (canvas.toBlob) {
  canvas.toBlob(/* ... */);
}
```

**❌ WRONG - Explains WHAT:**
```typescript
// Set the hue value
dispatch(setHue(h));

// Calculate RGB from HSL
const rgb = hslToRgb(h, s, l);

// Get the preview URL from state
const previewUrl = useAppSelector((state) => state.image.previewUrl);
```

**❌ WRONG - Obvious comment:**
```typescript
// Initialize state
const [copied, setCopied] = useState(false);

// Handle file change
const handleFileChange = (file: File) => {
  // ...
};
```

**❌ WRONG - JSX section comments (usually redundant):**
```typescript
return (
  <div>
    {/* Header section */}
    <header>...</header>
    
    {/* Body section */}
    <main>...</main>
    
    {/* Footer section */}
    <footer>...</footer>
  </div>
);
```

**✅ CORRECT - Only when section purpose is non-obvious:**
```typescript
return (
  <div>
    {/* Dynamic layer: canvas sized by aspect ratio, constrained by outer container */}
    <canvas ref={canvasRef} />
  </div>
);
```

## 4. TypeScript Types

### Do NOT Comment Types

**Types should be self-documenting through:**
- Clear type names
- Descriptive property names
- Union types with meaningful names

**❌ WRONG:**
```typescript
// Color mode type: HEX, HSL, or RGBA
type ColorMode = "HEX" | "HSL" | "RGBA";

// RGB color object with red, green, blue values
type RGB = { r: number; g: number; b: number };
```

**✅ CORRECT:**
```typescript
type ColorMode = "HEX" | "HSL" | "RGBA";

type RGB = { r: number; g: number; b: number };
```

**Exception:** Comment types only when intent is genuinely unclear:
```typescript
// Normalized HSL values (h: 0-360, s: 0-1, l: 0-1)
// Note: s and l are normalized to 0-1 range, not percentages
type NormalizedHSL = { h: number; s: number; l: number };
```

## 5. Comment Cleanup Rules

### Remove These Comments

1. **Obvious comments:**
   ```typescript
   // ❌ Remove
   // Set the state
   const [value, setValue] = useState(0);
   ```

2. **Line-by-line explanations:**
   ```typescript
   // ❌ Remove
   // Get the dispatch function
   const dispatch = useAppDispatch();
   // Get the preview URL
   const previewUrl = useAppSelector((state) => state.image.previewUrl);
   ```

3. **Redundant JSX comments:**
   ```typescript
   // ❌ Remove
   {/* Header */}
   <header>...</header>
   ```

4. **What comments (code already shows this):**
   ```typescript
   // ❌ Remove
   // Loop through colors
   colors.map(color => ...)
   ```

### Keep These Comments

1. **Why comments (explain reasoning):**
   ```typescript
   // ✅ Keep
   // Quantize to reduce similar colors in extraction
   const quantize = (value: number) => Math.round(value / 10) * 10;
   ```

2. **Performance decisions:**
   ```typescript
   // ✅ Keep
   // Scale down for performance - full resolution causes lag
   const maxDimension = 200;
   ```

3. **Architectural tradeoffs:**
   ```typescript
   // ✅ Keep
   // Use toBlob for better memory management with large images
   if (canvas.toBlob) { ... }
   ```

## 6. Documentation Templates

### Component Template
```typescript
/**
 * ComponentName
 * ----------------
 * [One sentence describing what the component is responsible for]
 * [Optional: Additional context about coordination or interactions]
 */
```

### Hook Template
```typescript
/**
 * useHookName
 * ----------------
 * [What the hook manages or provides]
 * [Optional: Additional context about state or side effects]
 * 
 * Side effects:
 * - [List any side effects, one per line]
 */
```

### Function Template
```typescript
/**
 * functionName
 * ----------------
 * [What the function does and its purpose]
 * 
 * Side effects:
 * - [List any side effects, if applicable]
 */
```

### Inline Comment Template
```typescript
// [WHY this approach/decision, not WHAT the code does]
// [Optional: Additional context about tradeoffs or performance]
```

## 7. Enforcement Checklist

Before considering code complete:

- [ ] Every exported component has documentation comment
- [ ] Every exported function/hook has documentation comment
- [ ] No line-by-line comments explaining obvious code
- [ ] Inline comments explain WHY, not WHAT
- [ ] TypeScript types are self-documenting (no type comments)
- [ ] Redundant JSX section comments removed
- [ ] Performance/architectural decisions are documented
- [ ] Non-obvious logic has explanatory comments

## Current Violations

### Missing Component Documentation
- Most components lack documentation comments
- Need to add after imports, before component definition

### Missing Hook Documentation
- `useAppDispatch` - needs documentation
- Other hooks may need documentation

### Redundant Comments Found
- JSX section comments in `creator-badge.tsx`
- Obvious comments in various files
- "What" comments that should be removed

### Good Examples Found
- Canvas rendering comment in `result-canvas.tsx` (explains WHY)
- Color extraction comment in `utils/color.ts` (explains purpose)

## Notes

- **DO NOT** add comments to every line
- **DO NOT** comment obvious code
- **DO** document exported APIs (components, functions, hooks)
- **DO** explain non-obvious decisions and tradeoffs
- **DO** prefer clear naming over comments
